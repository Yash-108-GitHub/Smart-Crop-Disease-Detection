<% layout("/layouts/boilerplate") %>

<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h2 class="page-title mb-0">ðŸŒ¿ Crop Disease Detection</h2>
      <small class="text-muted">Upload leaf image â†’ Get disease & confidence</small>
    </div>
    <a href="/" class="btn btn-outline-primary">Home</a>
  </div>

  <div class="row g-4">
    <!-- Upload Card -->
    <div class="col-lg-6">
      <div class="card shadow-sm p-3">
        <h5 class="mb-3">Upload Leaf Image</h5>

        <% if (typeof error !== "undefined" && error) { %>
          <div class="alert alert-danger"><%= error %></div>
        <% } %>

        <form action="/detect-disease" method="POST" enctype="multipart/form-data">
          <div class="mb-3">
            <input class="form-control" type="file" name="image" id="imageInput" accept="image/*" required>
          </div>

          <div class="preview-box mb-3">
            <img id="preview" src="https://via.placeholder.com/900x500?text=Image+Preview" alt="preview" style="width:100%; height:280px; object-fit:cover; border-radius:12px;">
          </div>

          <button class="btn btn-primary w-100" type="submit">Predict Disease</button>
        </form>

        <small class="text-muted d-block mt-3">
          Tip: Use clear leaf photo (good light, close-up, no blur).
        </small>
      </div>
    </div>

    <!-- Result Card -->
    <div class="col-lg-6">
      <div class="card shadow-sm p-3">
        <h5 class="mb-3">Result</h5>

        <% if (typeof prediction !== "undefined" && prediction) { %>
          <div class="mb-3">
            <span class="badge text-bg-success">Prediction Ready âœ…</span>
          </div>

          <% if (typeof imageUrl !== "undefined" && imageUrl) { %>
            <div class="preview-box mb-3">
              <img src="<%= imageUrl %>" alt="Uploaded leaf" style="width:100%; height:280px; object-fit:cover; border-radius:12px;">
            </div>
          <% } %>

          <div class="p-3 rounded" style="background:#e6f4ea;">
            <p class="mb-2"><strong>Disease:</strong> <%= prediction.disease %></p>
            <p class="mb-0"><strong>Confidence:</strong> <%= prediction.confidence %>%</p>
          </div>

        <% } else { %>
          <div class="text-muted">
            Upload an image to see prediction here.
          </div>
        <% } %>
      </div>
    </div>
  </div>
</div>

<script>
  const imageInput = document.getElementById("imageInput");
  const preview = document.getElementById("preview");

  imageInput.addEventListener("change", function () {
    const file = this.files && this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      preview.src = e.target.result;
    };
    reader.readAsDataURL(file);
  });
</script>